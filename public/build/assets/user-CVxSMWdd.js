import{a as L}from"./index-NIGUFBhG.js";L.defaults.headers.common["X-CSRF-TOKEN"]=document.querySelector('meta[name="csrf-token"]').content;L.defaults.headers.common["Content-Type"]="application/json";let h,B,r,u,p,v,x,w,b,E,c,U,S,D,T,i,N,f=null,m=[];window.addEventListener("load",function(){initUserSection()});window.initUserSection=()=>{h=document.getElementById("openModal"),B=document.getElementById("closeAddModal"),r=document.getElementById("addUserModal"),u=document.getElementById("addUserForm"),p=document.getElementById("errorName"),v=document.getElementById("errorEmail"),x=document.getElementById("user-list"),w=document.getElementById("user-detail-panel"),c=document.getElementById("deleteUserModal"),U=document.getElementById("closeDeleteModal"),S=document.getElementById("confirmDeleteBtn"),D=document.getElementById("cancelDeleteBtn"),T=document.getElementById("userNameToDelete"),i=document.getElementById("messageModal"),N=document.getElementById("messageText"),b=document.getElementById("app-container"),E=document.getElementById("menu-button"),!(!h||!B||!r)&&(h.addEventListener("click",()=>{r.classList.remove("hidden")}),B.addEventListener("click",()=>{r.classList.add("hidden"),u.reset(),p.textContent="",v.textContent=""}),r.addEventListener("click",e=>{e.target===r&&(r.classList.add("hidden"),u.reset())}),c.addEventListener("click",e=>{e.target===c&&c.classList.add("hidden")}),U.addEventListener("click",()=>{c.classList.add("hidden")}),S.addEventListener("click",()=>{f&&(m=m.filter(e=>e.id!==f),C(),w.innerHTML=`<div class="flex items-center justify-center h-full text-gray-500">
                                                <span class="hidden md:block text-lg">Selecciona un usuario</span>
                                            </div>`,f=null,c.classList.add("hidden"),M("Usuario eliminado correctamente.","success"))}),D.addEventListener("click",()=>{c.classList.add("hidden")}),F(),u.addEventListener("submit",$))};async function F(){try{m=(await L.get("/panel/get_users")).data,C()}catch(e){console.error("Error al cargar usuarios:",e)}}function C(){x.innerHTML="",m.forEach(e=>{const t=document.createElement("div");t.className="user-list-item p-4 flex items-center space-x-4 border-b border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors",t.dataset.userId=e.id,f===e.id&&t.classList.add("active"),t.innerHTML=`
                    <div class="w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center text-white font-bold text-lg">
                        ${e.name.charAt(0).toUpperCase()}
                    </div>
                    <div class="flex-1">
                        <div class="font-semibold text-gray-900">${e.name}</div>
                        <div class="text-sm text-gray-500">${e.email}</div>
                    </div>
                `,t.addEventListener("click",()=>V(e.id)),x.appendChild(t)})}async function $(e){e.preventDefault(),p.textContent="",v.textContent="";const t=u.querySelector('button[type="submit"]'),a=t.innerHTML;t.disabled=!0,t.innerHTML='<span class="loader"></span>';const d=new FormData(u);try{const n=(await L.post("/panel/store_user",{name:d.get("name"),email:d.get("email")})).data.user;m.unshift(n),C(),r.classList.add("hidden"),u.reset()}catch(s){if(s.response&&s.response.status===422){const n=s.response.data.errors;n.name&&(p.textContent=n.name[0]),n.email&&(v.textContent=n.email[0])}else alert("Ocurrió un error. Intenta nuevamente.")}finally{t.disabled=!1,t.innerHTML=a}}function V(e){f=e;const t=m.find(s=>s.id===e);if(!t)return;document.querySelectorAll(".user-list-item").forEach(s=>{s.classList.remove("active")});const a=document.querySelector(`[data-user-id="${e}"]`);a&&a.classList.add("active"),highlightSelectedItem("[data-user-id]",e),document.getElementById("back-button").addEventListener("click",_),b.classList.add("user-active"),j(t),A()}function j(e){const t=document.getElementById("user-empty-state"),a=document.getElementById("user-detail-card");t.classList.add("hidden"),a.classList.remove("hidden"),document.getElementById("user-avatar").textContent=e.name.charAt(0).toUpperCase(),document.getElementById("user-name").textContent=e.name,document.getElementById("user-email").textContent=e.email,document.getElementById("user-password").textContent=e.password?"********":"Sin clave",document.getElementById("user-role").textContent=e.role??"Vendedor",document.getElementById("user-created").textContent=new Date(e.created_at).toLocaleDateString();const d=document.getElementById("deleteUserBtn");d.onclick=()=>R(e);const s=document.getElementById("sendResetBtn");s.onclick=()=>W(e.id),I()}function I(){document.querySelectorAll("[data-field]").forEach(e=>{e.addEventListener("dblclick",()=>P(e))})}function P(e){const t=e.dataset.id,a=e.dataset.field,d=e.textContent.trim(),s=a==="password",n=document.createElement("input");n.type="text",n.value=s?"":d,n.placeholder=s?"Nueva clave":"",n.className="w-full px-2 py-1 bg-gray-200 text-gray-900 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors";const H=e.parentElement;let k=!1;H.classList.contains("flex")&&(k=!0,e.style.flex="1",n.style.flex="1"),e.replaceWith(n),n.focus();const y=()=>{const o=n.value.trim(),l=m.find(q=>q.id==t),g=document.createElement("span");l&&(o!==""&&(l[a]=o),g.textContent=s?"********":o||d,g.className=e.className,g.dataset.field=a,g.dataset.id=t,n.replaceWith(g),k&&(g.style.flex="1"),o!==""&&o!==d&&M("Cambio guardado exitosamente.","success")),I()};n.addEventListener("blur",y),n.addEventListener("keydown",o=>{if(o.key==="Enter")n.removeEventListener("blur",y),y();else if(o.key==="Escape"){n.removeEventListener("blur",y);const l=document.createElement("span");l.textContent=d,l.className=e.className,l.dataset.field=a,l.dataset.id=t,n.replaceWith(l),I()}})}function R(e){T.textContent=e.name,c.classList.remove("hidden")}function W(e){const t=m.find(a=>a.id===e);t&&M(`Simulando envío de correo de restablecimiento de clave a ${t.email}`,"info")}function M(e,t="info"){N.textContent=e,t==="success"?(i.classList.remove("bg-gray-800"),i.classList.add("bg-green-600")):(i.classList.remove("bg-green-600"),i.classList.add("bg-gray-800")),i.classList.remove("hidden"),i.classList.add("animate-fade-in"),setTimeout(()=>{i.classList.add("hidden"),i.classList.remove("animate-fade-in")},3e3)}const _=()=>{f=null,b.classList.remove("user-active"),A()},A=()=>{E&&(f?E.classList.add("hidden"):E.classList.remove("hidden"))};
